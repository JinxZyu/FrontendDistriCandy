<div class="proveedor-container">
  <!-- Header -->
  <div class="proveedor-header">
    <h1>Gestión de Proveedores</h1>
    <button class="btn btn-primary" (click)="abrirFormularioCrear()">
      <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" fill="white"/>
      </svg>
      <span>Nuevo Proveedor</span>
    </button>
  </div>

  <!-- Mensajes -->
  <div *ngIf="mensaje" [class]="'mensaje ' + tipoMensaje">
    <div class="mensaje-icon">
      <svg *ngIf="tipoMensaje === 'success'" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
      </svg>
      <svg *ngIf="tipoMensaje === 'error'" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
      </svg>
    </div>
    <span>{{ mensaje }}</span>
  </div>

  <!-- Cargando -->
  <div *ngIf="cargando" class="cargando">
    <div class="spinner"></div>
    <span>Cargando proveedores...</span>
  </div>

  <!-- Tabla de proveedores -->
  <div *ngIf="!cargando" class="table-container">
    <table class="proveedor-table">
      <thead>
        <tr>
          <th>NIT</th>
          <th>Nombre</th>
          <th>Celular</th>
          <th>Correo</th>
          <th>Dirección</th>
          <th>Estado</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let proveedor of proveedores">
          <td>{{ proveedor.nit }}</td>
          <td>{{ proveedor.nombre }}</td>
          <td>{{ proveedor.celular }}</td>
          <td>{{ proveedor.correo }}</td>
          <td>{{ proveedor.direccion }}</td>
          <td>
            <span [class]="getEstadoClase(proveedor.estado)">
              {{ getEstadoTexto(proveedor.estado) }}
            </span>
          </td>
          <td class="acciones">
            <button class="btn btn-editar" (click)="abrirFormularioEditar(proveedor)">
              <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z" fill="white"/>
              </svg>
              <span>Editar</span>
            </button>
            <button class="btn btn-estado" (click)="cambiarEstadoProveedor(proveedor.id!)">
              <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" fill="white"/>
              </svg>
              <span>{{ proveedor.estado === 1 ? 'Desactivar' : 'Activar' }}</span>
            </button>
          </td>
        </tr>
        <tr *ngIf="proveedores.length === 0">
          <td colspan="7" class="no-data">
            <div class="no-data-content">
              <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M20 6h-2.18c.11-.31.18-.65.18-1 0-1.66-1.34-3-3-3-1.05 0-1.96.54-2.5 1.35l-.5.67-.5-.68C10.96 2.54 10.05 2 9 2 7.34 2 6 3.34 6 5c0 .35.07.69.18 1H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-5-2c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM9 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm11 15H4v-2h16v2zm0-5H4V8h5.08L7 10.83 8.62 12 11 8.76l1-1.36 1 1.36L15.38 12 17 10.83 14.92 8H20v6z" fill="#8B7355"/>
              </svg>
              <p>No hay proveedores registrados</p>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Modal Formulario -->
  <div *ngIf="mostrarFormulario" class="modal-overlay" (click)="cerrarFormulario()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>{{ esEdicion ? 'Editar Proveedor' : 'Crear Proveedor' }}</h2>
        <button class="btn-cerrar" (click)="cerrarFormulario()">×</button>
      </div>
      
      <form (ngSubmit)="esEdicion ? actualizarProveedor() : crearProveedor()" #form="ngForm">
        <div class="form-group">
          <label for="nit">NIT *</label>
          <input
            type="text"
            id="nit"
            name="nit"
            [(ngModel)]="proveedorActual.nit"
            required
            #nit="ngModel"
            (input)="validarCampo('nit', proveedorActual.nit)"
            maxlength="10"
            [class.invalid]="(nit.invalid && nit.touched) || erroresValidacion.nit"
            placeholder="Solo números (máx. 10 dígitos)">
          <div *ngIf="nit.invalid && nit.touched" class="error">
            El NIT es requerido
          </div>
          <div *ngIf="erroresValidacion.nit" class="error">
            {{ erroresValidacion.nit }}
          </div>
        </div>

        <div class="form-group">
          <label for="nombre">Nombre *</label>
          <input
            type="text"
            id="nombre"
            name="nombre"
            [(ngModel)]="proveedorActual.nombre"
            required
            #nombre="ngModel"
            (input)="validarCampo('nombre', proveedorActual.nombre)"
            [class.invalid]="(nombre.invalid && nombre.touched) || erroresValidacion.nombre"
            placeholder="Solo letras, espacios y guiones">
          <div *ngIf="nombre.invalid && nombre.touched" class="error">
            El nombre es requerido
          </div>
          <div *ngIf="erroresValidacion.nombre" class="error">
            {{ erroresValidacion.nombre }}
          </div>
        </div>

        <div class="form-group">
          <label for="celular">Celular</label>
          <input
            type="text"
            id="celular"
            name="celular"
            [(ngModel)]="proveedorActual.celular"
            (input)="validarCampo('celular', proveedorActual.celular)"
            maxlength="10"
            [class.invalid]="erroresValidacion.celular"
            placeholder="Solo números (máx. 10 dígitos)">
          <div *ngIf="erroresValidacion.celular" class="error">
            {{ erroresValidacion.celular }}
          </div>
        </div>

        <div class="form-group">
          <label for="correo">Correo *</label>
          <input
            type="email"
            id="correo"
            name="correo"
            [(ngModel)]="proveedorActual.correo"
            required
            #correo="ngModel"
            (input)="validarCampo('correo', proveedorActual.correo)"
            [class.invalid]="(correo.invalid && correo.touched) || erroresValidacion.correo"
            placeholder="ejemplo@dominio.com">
          <div *ngIf="correo.invalid && correo.touched" class="error">
            El correo es requerido
          </div>
          <div *ngIf="erroresValidacion.correo" class="error">
            {{ erroresValidacion.correo }}
          </div>
        </div>

        <div class="form-group">
          <label for="direccion">Dirección</label>
          <textarea
            id="direccion"
            name="direccion"
            [(ngModel)]="proveedorActual.direccion"
            (input)="validarCampo('direccion', proveedorActual.direccion)"
            rows="3"
            [class.invalid]="erroresValidacion.direccion"
            placeholder="Letras, números, #, -, . permitidos"></textarea>
          <div *ngIf="erroresValidacion.direccion" class="error">
            {{ erroresValidacion.direccion }}
          </div>
        </div>

        <div class="form-actions">
          <button type="button" class="btn btn-secondary" (click)="cerrarFormulario()">
            Cancelar
          </button>
          <!-- Cambia esta línea en el botón de enviar -->
<button 
  type="submit" 
  class="btn btn-primary" 
  [class.btn-disabled]="!formularioCompleto() || tieneErrores()"
  [disabled]="!formularioCompleto() || tieneErrores()">
  {{ esEdicion ? 'Actualizar' : 'Crear' }}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>