<div class="categoria-container">
  <!-- Header -->
  <div class="categoria-header">
    <h1>Gestión de Categorías</h1>
    <button class="btn btn-primary" (click)="abrirFormularioCrear()">
      <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" fill="white"/>
      </svg>
      <span>Nueva Categoría</span>
    </button>
  </div>

  <!-- Mensajes -->
  <div *ngIf="mensaje" [class]="'mensaje ' + tipoMensaje">
    <div class="mensaje-icon">
      <svg *ngIf="tipoMensaje === 'success'" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
      </svg>
      <svg *ngIf="tipoMensaje === 'error'" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
      </svg>
    </div>
    <span>{{ mensaje }}</span>
  </div>

  <!-- Cargando -->
  <div *ngIf="cargando" class="cargando">
    <div class="spinner"></div>
    <span>Cargando categorías...</span>
  </div>

  <!-- Tabla de categorías -->
  <div *ngIf="!cargando" class="table-container">
    <table class="categoria-table">
      <thead>
        <tr>
          <th>ID</th>
          <th>Nombre</th>
          <th>Estado</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let categoria of categorias">
          <td>{{ categoria.idCategoria }}</td>
          <td>{{ categoria.nombre }}</td>
          <td>
            <span [class]="getEstadoClase(categoria.estado ?? 0)">
              {{ getEstadoTexto(categoria.estado ?? 0) }}
            </span>
          </td>
          <td class="acciones">
            <button class="btn btn-estado" (click)="cambiarEstadoCategoria(categoria.idCategoria!)">
              <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" fill="white"/>
              </svg>
              <span>{{ (categoria.estado ?? 0) === 1 ? 'Desactivar' : 'Activar' }}</span>
            </button>
            <!-- Se eliminó el botón de eliminar -->
          </td>
        </tr>
        <tr *ngIf="categorias.length === 0">
          <td colspan="4" class="no-data">
            <div class="no-data-content">
              <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z" fill="#8B7355"/>
              </svg>
              <p>No hay categorías registradas</p>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Modal Formulario -->
  <div *ngIf="mostrarFormulario" class="modal-overlay" (click)="cerrarFormulario()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Crear Categoría</h2>
        <button class="btn-cerrar" (click)="cerrarFormulario()">×</button>
      </div>
      
      <form (ngSubmit)="crearCategoria()" #form="ngForm">
        <div class="form-group">
          <label for="nombre">Nombre *</label>
          <input
            type="text"
            id="nombre"
            name="nombre"
            [(ngModel)]="categoriaActual.nombre"
            required
            #nombre="ngModel"
            (input)="validarCampo('nombre', categoriaActual.nombre)"
            [class.invalid]="(nombre.invalid && nombre.touched) || erroresValidacion.nombre"
            placeholder=" ">
          <div *ngIf="nombre.invalid && nombre.touched" class="error">
            El nombre es requerido
          </div>
          <div *ngIf="erroresValidacion.nombre" class="error">
            {{ erroresValidacion.nombre }}
          </div>
        </div>

        <div class="form-actions">
          <button type="button" class="btn btn-secondary" (click)="cerrarFormulario()">
            Cancelar
          </button>
          <button 
            type="submit" 
            class="btn btn-primary" 
            [class.btn-disabled]="!formularioCompleto() || tieneErrores()"
            [disabled]="!formularioCompleto() || tieneErrores()">
            Crear
          </button>
        </div>
      </form>
    </div>
  </div>
</div>